<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>WorldOrchestra</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
        <!-- build:css(.tmp) styles/main.css -->
        <link rel="stylesheet" href="styles/main.css">
        <!-- endbuild -->
        <!-- build:js scripts/vendor/modernizr.js -->
        <script src="bower_components/modernizr/modernizr.js"></script>
        <!-- endbuild -->
    </head>
    <body>
        <!--[if lt IE 10]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->


        <div class="hero-unit">
          <h1>'Allo, 'Allo!</h1>
          <p>You now have</p>
          <ul>
            <li>HTML5 Boilerplate</li>
            <li>jQuery</li>
            <li>Backbone.js</li>
            <li>Underscore.js</li>
            <li>Modernizr</li>
            <li>RequireJS</li>
            <li>Marionette</li>
          </ul>
        </div>
        <div id="content"></div>
        <script type="text/template" id="sample-template">
            put some content <%= contentPlacement %>.
        </script>


        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->

        <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-XXXXX-X');ga('send','pageview');
        </script>
        
        <script src="bower_components/tone/build/Tone.js"></script>

        <script>
        /* globals Tone, GUI */

        var synthOptions = {
            "portamento" : 0.05,
            "oscillator" : {
                "type" : "square"
            },
            "filter": {
                "Q": 6,
                "type": "lowpass",
                "rolloff": -24
            },
            "envelope": {
                "attack": 0.005,
                "decay": 0.01,
                "sustain": 0.9,
                "release": 0.001
            },
            "filterEnvelope": {
                "attack": 0.006,
                "decay": 0.02,
                "sustain": 0.5,
                "release": 0.001,
                "min": 10,
                "max": 4000
            }
        };

        var synth = new Tone.MonoSynth(synthOptions);
        synth.setVolume(-10);
        synth.toMaster();

        var synthPart = [["0", "C2"], ["1*8n", "C4"], ["2*8n", "E4"], ["3*8n", "B3"], 
            ["4*8n", "G3"], ["5*8n", "C2"], ["6*8n", "C4"], ["7*8n", "B1"]];

                         //[time,               note, velocity]
        var otherPart = [["5:0:2.8333333333333286","E3","0.83"],["5:1:0.4166666666666714","E3","0.00"],["5:1:1.9583333333333286","F3","0.80"],["5:1:2.375","F3","0.00"],["5:1:2.8333333333333286","G3","0.80"],["5:1:3.625","G3","0.00"],["5:2:1.0833333333333286","C4","0.85"],["6:0:2.0833333333333286","C4","0.00"],["6:0:2.8333333333333286","D3","0.83"],["6:0:3.8333333333333286","D3","0.00"],["6:1:1.9583333333333286","E3","0.80"],["6:1:2.375","E3","0.00"],["6:1:2.8333333333333286","F3","0.84"],["7:0:1.8333333333333286","F3","0.00"],["7:0:2.8333333333333286","G3","0.83"],["7:1:0.4166666666666714","G3","0.00"],["7:1:1.9583333333333286","A3","0.80"],["7:1:2.375","A3","0.00"],["7:1:2.8333333333333286","B3","0.81"],["7:1:3.625","B3","0.00"],["7:2:1.0833333333333286","F4","0.85"],["8:0:2.083333333333343","F4","0.00"],["8:0:2.833333333333343","A3","0.80"],["8:0:3.833333333333343","A3","0.00"],["8:1:1.9583333333333428","B3","0.83"],["8:1:2.375","B3","0.00"],["8:1:2.833333333333343","C4","0.87"],["8:2:0.8333333333333428","C4","0.00"],["8:2:2.833333333333343","D4","0.85"],["8:3:0.8333333333333428","D4","0.00"],["8:3:2.833333333333343","E4","0.83"],["9:0:1.8333333333333428","E4","0.00"],["9:0:2.833333333333343","E3","0.85"],["9:1:0.4166666666666572","E3","0.00"],["9:1:1.9583333333333428","F3","0.83"],["9:1:2.375","F3","0.00"],["9:1:2.833333333333343","G3","0.83"],["9:1:3.625","G3","0.00"],["9:2:1.0833333333333428","C4","0.86"],["10:0:2.083333333333343","C4","0.00"],["10:0:2.833333333333343","D4","0.88"],["10:0:3.833333333333343","D4","0.00"],["10:1:1.9583333333333428","E4","0.81"],["10:1:2.375","E4","0.00"],["10:1:2.833333333333343","F4","0.85"],["11:0:1.8333333333333428","F4","0.00"],["11:0:2.833333333333343","G3","0.83"],["11:0:3.833333333333343","G3","0.00"],["11:1:1.9583333333333428","G3","0.83"],["11:1:2.375","G3","0.00"],["11:1:2.833333333333343","F3","0.76"],["11:2:2.416666666666657","F3","0.00"],["11:2:2.833333333333343","G3","0.80"],["11:2:3.625","G3","0.00"],["11:3:1.9583333333333428","G3","0.83"],["11:3:2.375","G3","0.00"],["11:3:2.833333333333343","F3","0.78"],["12:0:2.416666666666657","F3","0.00"],["12:0:2.833333333333343","G3","0.77"],["12:0:3.625","G3","0.00"],["12:1:1.9583333333333428","G3","0.85"],["12:1:2.375","G3","0.00"],["12:1:2.833333333333343","F3","0.76"],["12:2:2.416666666666657","F3","0.00"],["12:2:2.833333333333343","G3","0.80"],["12:2:3.625","G3","0.00"],["12:3:1.9583333333333428","G3","0.83"],["12:3:2.375","G3","0.00"],["12:3:2.833333333333343","F3","0.78"],["13:0:0.625","F3","0.00"],["13:0:0.8333333333333428","G3","0.77"],["13:0:1.625","G3","0.00"],["13:0:2.833333333333343","E3","0.83"],["13:1:0.4166666666666572","E3","0.00"],["13:1:1.9583333333333428","F3","0.80"],["13:1:2.375","F3","0.00"],["13:1:2.833333333333343","G3","0.80"],["13:1:3.625","G3","0.00"],["13:2:1.0833333333333428","C4","0.85"],["14:0:2.083333333333343","C4","0.00"],["14:0:2.833333333333343","D3","0.83"],["14:0:3.833333333333343","D3","0.00"],["14:1:1.9583333333333428","E3","0.80"],["14:1:2.375","E3","0.00"],["14:1:2.833333333333343","F3","0.84"],["15:0:1.8333333333333428","F3","0.00"],["15:0:2.833333333333343","G3","0.83"],["15:1:0.4166666666666572","G3","0.00"],["15:1:1.9583333333333428","A3","0.80"],["15:1:2.375","A3","0.00"],["15:1:2.833333333333343","B3","0.81"],["15:1:3.625","B3","0.00"],["15:2:1.0833333333333428","F4","0.85"],["16:0:2.0833333333333144","F4","0.00"],["16:0:2.8333333333333144","A3","0.80"],["16:0:3.8333333333333144","A3","0.00"],["16:1:1.9583333333333144","B3","0.83"],["16:1:2.375","B3","0.00"],["16:1:2.8333333333333144","C4","0.87"],["16:2:0.8333333333333144","C4","0.00"],["16:2:2.8333333333333144","D4","0.85"],["16:3:0.8333333333333144","D4","0.00"],["16:3:2.8333333333333144","E4","0.83"],["17:0:1.8333333333333144","E4","0.00"],["17:0:2.8333333333333144","E3","0.85"],["17:1:0.4166666666666856","E3","0.00"],["17:1:1.9583333333333144","F3","0.83"],["17:1:2.375","F3","0.00"],["17:1:2.8333333333333144","G3","0.83"],["17:1:3.625","G3","0.00"],["17:2:1.0833333333333144","C4","0.86"],["18:0:2.0833333333333144","C4","0.00"],["18:0:2.8333333333333144","D4","0.88"],["18:0:3.8333333333333144","D4","0.00"],["18:1:1.9583333333333144","E4","0.81"],["18:1:2.375","E4","0.00"],["18:1:2.8333333333333144","F4","0.85"],["19:0:1.8333333333333144","F4","0.00"],["29:0:2.8333333333333144","E3","0.78"],["29:0:3.8333333333333144","E3","0.00"],["29:1:1.9583333333333144","G3","0.78"],["29:1:2.5416666666666856","G3","0.00"],["29:1:2.8333333333333144","F3","0.76"],["30:0:1.8333333333333144","F3","0.00"],["30:0:2.8333333333333144","D3","0.74"],["30:0:3.8333333333333144","D3","0.00"],["30:1:1.9583333333333144","F3","0.72"],["30:1:2.5416666666666856","F3","0.00"],["30:1:2.8333333333333144","E3","0.73"],["30:1:3.625","E3","0.00"],["30:2:0","G3","0.74"],["30:2:0.7916666666666856","G3","0.00"],["30:2:1.1666666666666856","E4","0.77"],["31:0:2.1666666666666856","E4","0.00"],["31:0:2.8333333333333144","E3","0.74"],["31:0:3.8333333333333144","E3","0.00"],["31:1:1.9583333333333144","G3","0.72"],["31:1:2.5416666666666856","G3","0.00"],["31:1:2.8333333333333144","F3","0.76"],["32:0:1.8333333333333712","F3","0.00"],["32:0:2.8333333333333712","D3","0.72"],["32:0:3.8333333333333712","D3","0.00"],["32:1:1.9583333333333712","F3","0.72"],["32:1:2.5416666666666288","F3","0.00"],["32:1:2.8333333333333712","D#3","0.73"],["32:1:3.625","D#3","0.00"],["32:2:0","D3","0.74"],["32:2:0.7916666666666288","D3","0.00"],["32:2:1.1666666666666288","C3","0.77"],["33:0:2.1666666666666288","C3","0.00"],["33:0:2.8333333333333712","E3","0.80"],["33:0:3.8333333333333712","E3","0.00"],["33:1:1.9583333333333712","G3","0.77"],["33:1:2.5416666666666288","G3","0.00"],["33:1:2.8333333333333712","F3","0.78"],["34:0:1.8333333333333712","F3","0.00"]];

        Tone.Note.Score = function (score){
                   var notes = [];
                   for (var inst in score){
                       var part = score[inst];
                       if (inst === "tempo"){
                           Tone.Transport.setBpm(part);
                       } else if (inst === "timeSignature"){
                           Tone.Transport.setTimeSignature(part[0], part[1]);
                       } else if (Array.isArray(part)){
                           for (var i = 0; i < part.length; i+=2){
                               var noteDescription = part[i];
                               var note;
                               if (Array.isArray(noteDescription)){
                                   var time = noteDescription[0];
                                   var value = noteDescription.slice(1);
                                   var dur_time1=time.split(":");
                                   var dur_time2 = part[i+1][0].split(":");
                                   var duration = function(start, end){
                                        var duration=[];
                                        for( var i=0; i<3; i++ ){
                                            duration.push(Math.abs(end[i] - start[i]));
                                        }
                                        return duration.join(":");
                                   };
                                   var noteDuration = duration(dur_time1, dur_time2);
                                   note = new Tone.Note(inst, time, value, noteDuration);
                               } else {
                                   note = new Tone.Note(inst, noteDescription);
                               }
                               notes.push(note);
                           }
                       } else {
                           throw new TypeError("score parts must be Arrays");
                       }
                   }
                   console.log('notes->', notes);
                   console.log(notes.length);
                   return notes;
               };

        Tone.Note.Score({
            "synth" : otherPart
        });

        Tone.Transport.setBpm(130);
        // Tone.Transport.setLoopEnd("1:0");
        // Tone.Transport.loop = true;

        Tone.Note.route("synth", function(time, note, velocity, duration){
            synth.triggerAttackRelease(note, duration, time, velocity*0.2);
        });
        Tone.Transport.start();
    </script>

    
        <!-- build:js scripts/main.js -->

        <script src="scripts/main.js"></script>
        <!-- endbuild -->
</body>
</html>
