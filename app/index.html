<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>WorldOrchestra</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
        <!-- build:css(.tmp) styles/main.css -->
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="styles/main.css">
        <!-- endbuild -->
        <!-- build:js scripts/vendor/modernizr.js -->
        <script src="bower_components/modernizr/modernizr.js"></script>
        <!-- endbuild -->
    </head>
    <body>
        <!--[if lt IE 10]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->


        <div class="hero-unit">
          <h1>'Allo, 'Allo!</h1>
          <p>You now have</p>
          <ul>
            <li>HTML5 Boilerplate</li>
            <li>jQuery</li>
            <li>Backbone.js</li>
            <li>Underscore.js</li>
            <li>Modernizr</li>
            <li>RequireJS</li>
            <li>Marionette</li>
          </ul>
        
        <div>
            <button id="rewind"> <-- </button>
            <button id="stop">Stop</button>
            <button id="play"> > </button>
            <button id="forward"> --> </button>
            <button id="record">Record</button>
            <span>Transport Time </span><span id="transportTime">0:0:0</span>
        <div>
        <div id="keys">
        <button id="C4">Middle C</button>
        <button id="G4">Middle G</button>
        </div>
        <script type="text/template" id="sample-template">
            put some content <%= contentPlacement %>.
        </script>


        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->

        <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-XXXXX-X');ga('send','pageview');
        </script>
        
        <script src="bower_components/jquery/dist/jquery.js"></script>
        <script src="bower_components/tone/build/Tone.js"></script>
        <script src="indyFull.js"></script>

        <script>
        /* globals Tone, GUI */

        var synthOptions = {
            "portamento" : 0.05,
            "oscillator" : {
                "type" : "square"
            },
            "filter": {
                "Q": 6,
                "type": "lowpass",
                "rolloff": -24
            },
            "envelope": {
                "attack": 0.005,
                "decay": 0.01,
                "sustain": 0.9,
                "release": 0.001
            },
            "filterEnvelope": {
                "attack": 0.006,
                "decay": 0.02,
                "sustain": 0.5,
                "release": 0.001,
                "min": 10,
                "max": 4000
            }
        };

        var synth = new Tone.MonoSynth(synthOptions);
        var sampler = new Tone.MultiSampler({
            "A0" : "soundfont/acoustic_grand_piano-mp3/A0.mp3",
            "A1" : "soundfont/acoustic_grand_piano-mp3/A1.mp3",
            "A2" : "soundfont/acoustic_grand_piano-mp3/A2.mp3",
            "A3" : "soundfont/acoustic_grand_piano-mp3/A3.mp3",
            "A4" : "soundfont/acoustic_grand_piano-mp3/A4.mp3",
            "A5" : "soundfont/acoustic_grand_piano-mp3/A5.mp3",
            "A6" : "soundfont/acoustic_grand_piano-mp3/A6.mp3",
            "A7" : "soundfont/acoustic_grand_piano-mp3/A7.mp3",
            "B0" : "soundfont/acoustic_grand_piano-mp3/B0.mp3",
            "B1" : "soundfont/acoustic_grand_piano-mp3/B1.mp3",
            "B2" : "soundfont/acoustic_grand_piano-mp3/B2.mp3",
            "B3" : "soundfont/acoustic_grand_piano-mp3/B3.mp3",
            "B4" : "soundfont/acoustic_grand_piano-mp3/B4.mp3",
            "B5" : "soundfont/acoustic_grand_piano-mp3/B5.mp3",
            "B6" : "soundfont/acoustic_grand_piano-mp3/B6.mp3",
            "B7" : "soundfont/acoustic_grand_piano-mp3/B7.mp3",
            "C0" : "soundfont/acoustic_grand_piano-mp3/C0.mp3",
            "C1" : "soundfont/acoustic_grand_piano-mp3/C1.mp3",
            "C2" : "soundfont/acoustic_grand_piano-mp3/C2.mp3",
            "C3" : "soundfont/acoustic_grand_piano-mp3/C3.mp3",
            "C4" : "soundfont/acoustic_grand_piano-mp3/C4.mp3",
            "C5" : "soundfont/acoustic_grand_piano-mp3/C5.mp3",
            "C6" : "soundfont/acoustic_grand_piano-mp3/C6.mp3",
            "C7" : "soundfont/acoustic_grand_piano-mp3/C7.mp3",
            "C8" : "soundfont/acoustic_grand_piano-mp3/C8.mp3",
            "D0" : "soundfont/acoustic_grand_piano-mp3/D0.mp3",
            "D1" : "soundfont/acoustic_grand_piano-mp3/D1.mp3",
            "D2" : "soundfont/acoustic_grand_piano-mp3/D2.mp3",
            "D3" : "soundfont/acoustic_grand_piano-mp3/D3.mp3",
            "D4" : "soundfont/acoustic_grand_piano-mp3/D4.mp3",
            "D5" : "soundfont/acoustic_grand_piano-mp3/D5.mp3",
            "D6" : "soundfont/acoustic_grand_piano-mp3/D6.mp3",
            "D7" : "soundfont/acoustic_grand_piano-mp3/D7.mp3",
            "E0" : "soundfont/acoustic_grand_piano-mp3/E0.mp3",
            "E1" : "soundfont/acoustic_grand_piano-mp3/E1.mp3",
            "E2" : "soundfont/acoustic_grand_piano-mp3/E2.mp3",
            "E3" : "soundfont/acoustic_grand_piano-mp3/E3.mp3",
            "E4" : "soundfont/acoustic_grand_piano-mp3/E4.mp3",
            "E5" : "soundfont/acoustic_grand_piano-mp3/E5.mp3",
            "E6" : "soundfont/acoustic_grand_piano-mp3/E6.mp3",
            "E7" : "soundfont/acoustic_grand_piano-mp3/E7.mp3",
            "F0" : "soundfont/acoustic_grand_piano-mp3/F0.mp3",
            "F1" : "soundfont/acoustic_grand_piano-mp3/F1.mp3",
            "F2" : "soundfont/acoustic_grand_piano-mp3/F2.mp3",
            "F3" : "soundfont/acoustic_grand_piano-mp3/F3.mp3",
            "F4" : "soundfont/acoustic_grand_piano-mp3/F4.mp3",
            "F5" : "soundfont/acoustic_grand_piano-mp3/F5.mp3",
            "F6" : "soundfont/acoustic_grand_piano-mp3/F6.mp3",
            "F7" : "soundfont/acoustic_grand_piano-mp3/F7.mp3",
            "G0" : "soundfont/acoustic_grand_piano-mp3/G0.mp3",
            "G1" : "soundfont/acoustic_grand_piano-mp3/G1.mp3",
            "G2" : "soundfont/acoustic_grand_piano-mp3/G2.mp3",
            "G3" : "soundfont/acoustic_grand_piano-mp3/G3.mp3",
            "G4" : "soundfont/acoustic_grand_piano-mp3/G4.mp3",
            "G5" : "soundfont/acoustic_grand_piano-mp3/G5.mp3",
            "G6" : "soundfont/acoustic_grand_piano-mp3/G6.mp3",
            "G7" : "soundfont/acoustic_grand_piano-mp3/G7.mp3"
         }, onload);
         //once loaded..
        synth.setVolume(-25);
        synth.toMaster();
        
        sampler.setVolume(0);
        sampler.toMaster();

        
                         //[time,               note, velocity]
        Tone.Note.daveScore = function (song, score){
                   var notes = [];
                   for (var inst in score){
                       var part = score[inst];
                       if (inst === "tempo"){
                           Tone.Transport.setBpm(part);
                       } else if (inst === "timeSignature"){
                           Tone.Transport.setTimeSignature(part[0], part[1]);
                       } else if (Array.isArray(song[part])){
                           for (var i = 0; i < song[part].length; i+=2){
                               var noteDescription = song[part][i];
                               var note;
                               if (Array.isArray(noteDescription)){
                                   var time = noteDescription[0];
                                   var value = noteDescription.slice(1);
                                   var dur_time1=time;
                                   var dur_time2 = song[part][i+1][0];
                                   var duration = function(start, end){
                                        var duration = Math.abs(Tone.Transport.toSeconds(end) - Tone.Transport.toSeconds(start));
                                        return duration
                                   };
                                   var noteDuration = duration(dur_time1, dur_time2);
                                   note = new Tone.Note(inst, time, value, noteDuration);
                               } else {
                                   note = new Tone.Note(inst, noteDescription);
                               }
                               notes.push(note);
                           }
                       } else {
                           throw new TypeError("score parts must be Arrays");
                       }
                   }
                   console.log('notes->', notes);
                   console.log(notes.length);
                   return notes;indyFull
               };

        // Tone.Note.daveScore(indyFull, {
        //     "sampler" : "tk1"
        // });
        // Tone.Note.route("sampler", function(time, note, velocity, duration){
        //     sampler.triggerAttackRelease(note, duration, time, 1);
        //     // debugger;
        // });
        
        // Tone.Note.daveScore(indyFull, {
        //     "sampler" : "tk2"
        // });
        // Tone.Note.route("sampler", function(time, note, velocity, duration){
        //     sampler.triggerAttackRelease(note, duration, time, 1);
        //     // debugger;
        // });
        
        // Tone.Note.daveScore(indyFull, {
        //     "sampler" : "tk3"
        // });
        // Tone.Note.route("sampler", function(time, note, velocity, duration){
        //     sampler.triggerAttackRelease(note, duration, time, 1);
        //     // debugger;
        // });
        
        // Tone.Note.daveScore(indyFull, {
        //     "synth" : "tk4"
        // });
        // Tone.Note.route("synth", function(time, note, velocity, duration){
        //     synth.triggerAttackRelease(note, duration, time, 1);
        //     // debugger;
        // });

        Tone.Transport.setBpm(130);
        // Tone.Transport.setLoopEnd("1:0");
        // Tone.Transport.loop = true;

        // Tone.Transport.setTransportTime("4:0:0");
        
        $('#keys').on('mousedown','button', function(){
            var note = $(this).attr("id");
            console.log(note);
            sampler.triggerAttack(note)
        });

        $('#keys').on('mouseup','button', function(){
            var note = $(this).attr("id");
            sampler.triggerRelease(note)
        })

        $('#rewind').on('click', function(){
            Tone.Transport.setTransportTime("0:0:0");
            $('#transportTime').text(Tone.Transport.getTransportTime());
        })

        $('#stop').on('click', function(){
            $('#play').css("background-color", "white");
            $('#record').css("background-color", "white");
            Tone.Transport.stop();
            Tone.Transport.clearIntervals();
        })

        $('#play').on('click', function(){
            $('#play').css("background-color", "green");
            Tone.Transport.start();
            Tone.Transport.setInterval(function(time){
                $('#transportTime').text(Tone.Transport.getTransportTime());
            }, "16n");
        })


        $('#record').on('click', function(){
            $(this).css("background-color", "red");
            Tone.Transport.setTransportTime("0:0:0");
            Tone.Transport.start();
            Tone.Transport.setInterval(function(time){
                $('#transportTime').text(Tone.Transport.getTransportTime());
            }, "16n");
        })

        keyboard.keyDown = function(note, freq){
            sampler.triggerAttack(freq);
        };
        keyboard.keyUp = function(){
            sampler.triggerRelease();
        };

        //TURN ON TO HEAR MUSIC!!!!!
        Tone.Transport.start();


        // window.onload = function () {
        //     MIDI.loadPlugin({
        //         soundfontUrl: "soundfont/",
        //         instrument: "acoustic_grand_piano",
        
        //         callback: function() {
        //             var delay = 0; // play one note every quarter second
        //             var note = 50; // the MIDI note
        //             var velocity = 127; // how hard the note hits
        //             // play the note
        //             MIDI.setVolume(0, 127);
        //             MIDI.noteOn(0, note, velocity, delay);
        //             MIDI.noteOff(0, note, delay + 0.75);
        //             MIDI.Player.loadFile('Indiana.mid', function(){MIDI.Player.start()})
        //         }
        //     });
        // };

    </script>

    
        <!-- build:js scripts/main.js -->

        <script src="scripts/main.js"></script>
        <!-- endbuild -->
</body>
</html>
